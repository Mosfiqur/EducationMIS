<div class="p-4">
  <div class="row">
    <div class="col-12 site-maincontent-ctl">
      <div>
        <h1 class="pb-3 mb-0">
          All Users
        </h1>

        <div>
          <div class="my-4 pb-1">
            <a class="site-btn-primary py-2 px-3" [routerLink]="['/unicef/users/user-new']"><span> Add New User
              </span></a>
          </div>
        </div>

        <div></div>

        <div class="d-flex flex-wrap">
          <div class="flex-grow-1 mr-2">
            <div class="input-group mb-3 searchbox-with-filter">
              <div class="input-group-prepend">
                <span class="input-group-text">
                  <a class="filter-btn" type="button" data-toggle="collapse" data-target="#filter-main"
                    aria-expanded="false" aria-controls="collapseTwo">
                    <span class="px-2">Filter By</span>
                    <i class="fas fa-chevron-down pr-3"></i>
                  </a>
                </span>
              </div>
              <input placeholder="Enter name or designation here" type="text" name="userSearchText"
                [(ngModel)]="userSearchText" class="form-control" aria-label="Amount (to the nearest dollar)" />
              <span class="input-group-text search-icon p-0 px-2">
                <a>
                  <svg version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 26 26"
                    style="enable-background: new 0 0 26 26;" xml:space="preserve">
                    <g>
                      <path d="M22.8,22L18,17.1c1.3-1.5,2.1-3.5,2.1-5.6c0-4.7-3.8-8.5-8.5-8.5C6.8,3,3,6.8,3,11.5S6.8,20,11.5,20c2.1,0,4.1-0.8,5.6-2.1
                                            l4.9,4.9c0.1,0.1,0.3,0.2,0.4,0.2s0.3-0.1,0.4-0.2C23.1,22.6,23.1,22.2,22.8,22z M4.2,11.5c0-4,3.3-7.3,7.3-7.3s7.3,3.3,7.3,7.3
                                            s-3.3,7.3-7.3,7.3C7.5,18.9,4.2,15.6,4.2,11.5z" />
                    </g>
                  </svg>
                </a>
              </span>
            </div>
          </div>



          <div class="d-flex flex-wrap">
            <div class="flex-shrink-0 mr-2">
              <button class="btn site-btn-outlined" (click)="export()">
                EXPORT
              </button>
            </div>
          </div>
        </div>

        <!-- filer accordion start -->

        <div class="accordion" id="accordionExample" style="
        margin-bottom: 20px;">
          <div>
            <div id="filter-main" class="collapse" aria-labelledby="headingTwo" data-parent="#filter-main">
              <div class="allborder-box border-redious-xl p-3">
                <form class="site-form">
                  <div class="form-row">
                    <div class="form-group col-6">
                      <label>Filter by Roles</label>
                      <ng-multiselect-dropdown [placeholder]="'Select'" [data]="roles"
                        [(ngModel)]="filters.selectedRoles" [settings]="dropdownSettings" name="roles">
                      </ng-multiselect-dropdown>

                    </div>

                    <div class="form-group col-6">
                      <label>Filter by Education Sector Partners</label>
                      <ng-multiselect-dropdown [placeholder]="'Select'" [data]="espList"
                        [(ngModel)]="filters.selectedEsps" [settings]="dropdownSettings" name="espList">
                      </ng-multiselect-dropdown>
                    </div>
                  </div>
                </form>

                <div class="py-3 text-right">
                  <a class="btn site-btn-cutom-link" data-dismiss="modal" type="button" (click)="clearFilters()"
                    type="button" data-toggle="collapse" data-target="#filter-main" aria-expanded="false"
                    aria-controls="collapseTwo"><span>Cancel</span></a>
                  <button (click)="applyFilters()" data-toggle="collapse" data-target="#filter-main" type="button"
                    class="btn site-btn-primary ml-3" type="button">
                    <span>Filter Data</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- filer accordion end -->

        <div class="full-table-ctl">
          <!-- table control start -->
          <div class="py-3">
            <div class="table-control-head" id="#table-control-head-default">
              <div class="d-flex py-2 align-items-baseline">
                <div class="flex-grow-1 mr-3">
                  <div>
                    <!-- table info start -->

                    <div *ngIf="filters.selectedRoles.length || filters.selectedEsps.length">
                      <div class="d-flex align-content-start">
                        <p class="gry-text mr-2 py-1 my-auto">Now showing :</p>
                        <span *ngFor="let role of filters.selectedRoles"
                          class="filter-tag py-1 px-2 mr-2 my-1 d-flex flex-wrap">
                          <span class="mr-3 ml-1"> Role: {{role.text}}</span>
                          <span class="mr-1"><a (click)="deleselctRole(role)"><i class="fa fa-times"
                                aria-hidden="true"></i></a></span>
                        </span>

                        <span *ngFor="let esp of filters.selectedEsps"
                          class="filter-tag py-1 px-2 mr-2 my-1 d-flex flex-wrap">
                          <span class="mr-3 ml-1"> ESP: {{esp.text}}</span>
                          <span class="mr-1"><a (click)="deleselctEsp(esp)"><i class="fa fa-times"
                                aria-hidden="true"></i></a></span>
                        </span>
                      </div>
                    </div>

                    <!-- table info end -->
                  </div>
                </div>
                <add-dynamic-column [entityType]="entityTypeEnum.User" (onColumnAdded)="onColumnAdded($event)">
                </add-dynamic-column>
              </div>

              <!-- table option start -->

              <div [ngClass]="{ 'show-context-menu': userSelected }" class="table-cell-options py-2 px-2"
                id="#table-cell-option-show-hide">
                <div class="d-flex flex-wrap">
                  <p class="my-auto flex-grow-1 ml-2">
                    <span class="mr-2">{{ numberOfUsersSelected }}</span><span>User(s) selected</span>
                  </p>
                  <div class="d-flex">
                    <button type="button" *ngIf="!disableOnMultiSelection"
                      class="site-btn-outlined-white-borderd py-2 px-3 mr-3" [routerLink]="[
                        '/unicef/users/user',
                        totalSelected[0]?.id,
                        'edit'
                      ]">
                      <span class="mr-3">Edit</span>
                      <span>
                        <svg version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 26 26"
                          style="enable-background: new 0 0 26 26;" xml:space="preserve">
                          <g>
                            <g>
                              <g>
                                <g>
                                  <polygon points="7.4,15.7 6,20 10.3,18.6 " />
                                </g>
                              </g>
                              <g>
                                <g>
                                  <rect x="8.5" y="10.6"
                                    transform="matrix(0.7071 -0.7071 0.7071 0.7071 -5.1064 13.1195)" width="9.7"
                                    height="4.2" />
                                </g>
                              </g>
                              <g>
                                <g>
                                  <path
                                    d="M19.8,8.2l-2-2c-0.3-0.3-0.7-0.3-1,0l-0.6,0.6l2.9,2.9l0.6-0.6C20.1,8.9,20.1,8.4,19.8,8.2z" />
                                </g>
                              </g>
                            </g>
                          </g>
                        </svg>
                      </span>
                    </button>

                    <button type="button" *ngIf="!disableOnMultiSelection"
                      class="site-btn-outlined-white-borderd py-2 px-3 mr-3" (click)="onResetPassword()">
                      <span>Reset password</span>
                    </button>
                    <a (click)="confirmDeleteUsers()" class="site-btn-outlined-white-borderd py-2 px-3 mr-2">
                      <span class="mr-3">Delete</span>
                      <span>
                        <i class="fa fa-trash-alt"></i>
                      </span>
                    </a>
                  </div>
                </div>
              </div>
              <!-- table option end -->
            </div>
          </div>
          <!-- table control end -->

          <!-- table start -->
          <page-size-selector (onPageSizeChanged)="onPageSizeChanged($event)" [totalItems]="pagedUsers?.total">
          </page-size-selector>
          <!-- <div>
            <div class="site-table table-responsive">
              <table class="table table-editable">
                <thead>
                  <tr>
                    <th scope="row">
                      <div class="form-check">
                        <input
                          type="checkbox"
                          [ngModel]="isAllSelected"
                          (ngModelChange)="selectAll($event)"
                          class="form-check-input"
                          name="materialExampleRadios"
                          id="#chkoption"
                        />
                      </div>
                    </th>
                    <th scope="col">Name</th>
                    <th scope="col">Designation</th>
                    <th scope="col">ESP</th>
                    <th scope="col">Email</th>
                    <th scope="col">Role</th>
                    <th scope="col" *ngFor="let col of dynamicColumns">
                      {{col.name}}
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    *ngFor="let user of users | paginate : pageConfig">
                    <th scope="row ">
                      <div class="form-check">
                        <input
                          type="checkbox"
                          [(ngModel)]="user.isSelected"
                          (ngModelChange)="toggleSelection(user)"
                          class="form-check-input"
                          name="materialExampleRadios"
                          id="#chkoption"
                        />
                      </div>
                    </th>
                    <td *ngIf="canUpdateProfile">
                      <a routerLink="/unicef/users/profile/{{user.id}}" class="link">{{user.fullName }}</a>
                    </td>
                    <td *ngIf="!canUpdateProfile">
                      {{ user.fullName }}
                    </td>
                    <td>{{ user.designationName }}</td>
                    <td>{{ user.espNames }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.roleName }}</td>

                    <td *ngFor="let cell of user?.dynamicCells">
                        
                      <a class="cursor-pointer"> <span >
                      <cell-viewer                         
                      [cell]="cell"
                      (edit)="editDynamicCell(cell)"                        
                      (add)="addDynamicCell(cell)"  

                      [showAdd]="true"                                           
                      ></cell-viewer>
                      </span></a>
                    </td>
                    
                  </tr>
                </tbody>
              </table>
            </div>
            
            <pagination-controls (pageChange)="getPage($event)" id="user_list" class="d-flex justify-content-end pt-3"></pagination-controls>

          </div> -->
          <div>
            <ngx-datatable class='material' [columnMode]="ColumnMode.force" [selected]="selected"
              [selectionType]="SelectionType.checkbox" (select)="onNgxDataTableSelect($event)"
              [selectAllRowsOnPage]="true" [rowIdentity]="rowIdentity" [externalPaging]="true"
              [count]="page.totalElements" [offset]="page.pageNumber" [limit]="page.size" (page)="setPage($event)"
              (activate)="onActivate($event)" [rows]="rows" [columns]="columns" [scrollbarH]="true" [headerHeight]="50"
              [footerHeight]="50" rowHeight="auto"
              [virtualization]="false">
              <ngx-datatable-footer>
                <ng-template ngx-datatable-footer-template let-rowCount="rowCount" let-pageSize="pageSize"
                  let-selectedCount="selectedCount" let-curPage="curPage" let-offset="offset">

                  <div>
                    Selected: {{getSelected}} of {{rowCount}} total
                  </div>
                  <datatable-pager [pagerLeftArrowIcon]="'datatable-icon-left'"
                    [pagerRightArrowIcon]="'datatable-icon-right'" [pagerPreviousIcon]="'datatable-icon-prev'"
                    [pagerNextIcon]="'datatable-icon-skip'" [page]="curPage" [size]="pageSize" [count]="rowCount"
                    [hidden]="!((rowCount / pageSize) > 1)" (change)="setPage($event)">
                  </datatable-pager>
                </ng-template>
              </ngx-datatable-footer>
            </ngx-datatable>

            


            <ng-template #cellView list-type-cell-renderer let-column="column" let-row="row" ngx-datatable-cell-template
              let-value="value">

              <a class="cursor-pointer"> <span container="body" ngbTooltip="{{getListCellText(value)}}">
                  <cell-viewer [cell]="value" (edit)="editDynamicCell($event,value)"
                    (add)="addDynamicCell($event,value)" [showAdd]="true">
                  </cell-viewer>
                </span></a>
            </ng-template>

            <ng-template #userName let-column="column" let-row="row" ngx-datatable-cell-template let-value="value">

              <a class="cursor-pointer userName" [routerLink]="['/unicef/users/profile',row.id]" container="body" ngbTooltip="{{value}}"> {{value}}</a>
            </ng-template>

            <ng-template #hdrTplWithContextMenu let-column="column" ngx-datatable-header-template>
              <div class="header-btn">
                <span class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                </span>&nbsp;
                <span container="body" ngbTooltip="{{column.name}}">
                  {{column.name}}
                </span>

                <div class="dropdown-menu dropdown-menu-left">
                  <button class="dropdown-item" type="button"
                    (click)="openDynamicColumnModalForEdit(column.columnId)">Edit</button>

                  <button class="dropdown-item" type="button"
                    (click)="openDynamicColumnModalForDelete(column.columnId)">Remove</button>
                </div>
              </div>
            </ng-template>
            <ng-template #hdrTpl let-column="column" ngx-datatable-header-template>
              <span container="body" ngbTooltip="{{column.name}}">
                {{column.name}}
              </span>
            </ng-template>
            <ng-template #customCellTpl let-column="column" let-row="row" ngx-datatable-cell-template let-value="value">
              <span container="body" ngbTooltip="{{value}}">
                {{value}}
              </span>
            </ng-template>
          
          </div>

          <!-- table end -->
        </div>
      </div>
    </div>
  </div>


  <!-- Delete User -->
  <div class="modal fade deleteSelectedUser" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title red-text" id="exampleModalLabel">
            Confirm Action
          </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <h3 class="red-text">
            Are you sure you want to delete this user?
          </h3>
        </div>
        <div class="modal-footer">
          <a type="button" #closeDeleteModal class="btn site-btn-cutom-link"
            data-dismiss="modal"><span>Cancel</span></a>
          <a type="button" (click)="deleteUser()" class="btn site-btn-primary-red"><span>Delete</span></a>
        </div>
      </div>
    </div>
  </div>
  <!-- Delete User-->

  <!-- add new column Button Modal-->
  <div class="modal fade addNewColumn" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add New Column</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="exampleFormControlInput1">Lorem ipsum dolor</label>
              <input type="text" class="form-control" id="newColumnName" />
            </div>
            <div class="form-group">
              <label for="exampleFormControlInput1">Lorem ipsum dolor</label>
              <input type="text" class="form-control" />
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <a type="button" class="btn site-btn-cutom-link" data-dismiss="modal"><span>Cancel</span></a>
          <a type="button" class="btn site-btn-primary"><span>Add New Column</span></a>
        </div>
      </div>
    </div>
  </div>
  <!-- modal end add new column-->
</div>